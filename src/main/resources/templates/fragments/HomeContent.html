<!-- fragments/HomeContent.html -->
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<body>
    <div th:fragment="homeContent">
        <!-- Main Content -->
        <main class="main-content ">
            <!-- Hero Section -->
            <section class="hero text-center mb-5">
                <h1>Discover Books</h1>
                <p class="lead">Explore popular stories, trending novels, and new adventures.</p>

                <!-- Discover Images -->
                <div class="discover-gallery mt-4">
                    <div class="row justify-content-center g-4">
                        <div class="col-6 col-md-4 col-lg-3">
                            <a href="#" class="discover-link">
                                <img th:src="@{/images/discover1.jpg}" alt="Bleach" class="discover-img img-fluid rounded shadow-sm">
                                <p class="mt-2">Bleach</p>
                            </a>
                        </div>
                        <div class="col-6 col-md-4 col-lg-3">
                            <a href="#" class="discover-link">
                                <img th:src="@{/images/discover2.jpg}" alt="Newtype" class="discover-img img-fluid rounded shadow-sm">
                                <p class="mt-2">Newtype</p>
                            </a>
                        </div>
                        <div class="col-6 col-md-4 col-lg-3">
                            <a href="#" class="discover-link">
                                <img th:src="@{/images/discover3.jpg}" alt="One Piece" class="discover-img img-fluid rounded shadow-sm">
                                <p class="mt-2">One Piece</p>
                            </a>
                        </div>
                        <div class="col-6 col-md-4 col-lg-3">
                            <a href="#" class="discover-link">
                                <img th:src="@{/images/discover4.jpg}" alt="Constantine" class="discover-img img-fluid rounded shadow-sm">
                                <p class="mt-2">Constantine</p>
                            </a>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Book Grid Section -->
            <section>
                <h2>All Books</h2>
                <div id="booksGrid" class="books-grid" aria-live="polite"></div>
                <div id="emptyState" class="empty" hidden>No books found.</div>
            </section>
        </main>

        <!-- Scripts -->
        <script th:src="@{/scripts/Script.js}"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>

        <script type="module">
            import { apiGet, imgOrPlaceholder } from '/scripts/api.js';

            const grid = document.getElementById('booksGrid');
            const empty = document.getElementById('emptyState');
            const qInput = document.getElementById('q');
            const btnSearch = document.getElementById('btnSearch');

            function card(b) {
                return `
                <article class="book-card">
                    <a href="/book?id=${b.bookId}" class="thumb">
                        <img src="${imgOrPlaceholder(b.coverImageUrl)}" alt="${b.title}" loading="lazy"/>
                    </a>
                    <div class="meta">
                        <h3><a href="/book?id=${b.bookId}">${b.title}</a></h3>
                        <p class="genre">${b.genre ?? ''}</p>
                    </div>
                </article>`;
            }

            async function load(q) {
                grid.innerHTML = '';
                empty.hidden = true;
                const list = q && q.length ? await apiGet('/books', { q }) : await apiGet('/books');
                if (!list || list.length === 0) {
                    empty.hidden = false;
                    return;
                }
                grid.innerHTML = list.map(card).join('');
            }

            btnSearch.addEventListener('click', () => load(qInput.value.trim()));
            qInput.addEventListener('keydown', (e) => { if (e.key === 'Enter') load(qInput.value.trim()); });
            load();
        </script>

        <script>
            document.addEventListener('DOMContentLoaded', function () {
                var dropdownElements = [].slice.call(document.querySelectorAll('.dropdown-toggle'));
                dropdownElements.map(function (dropdownToggleEl) {
                    return new bootstrap.Dropdown(dropdownToggleEl);
                });
            });
        </script>
    </div>
</body>
</html>
